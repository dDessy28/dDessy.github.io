//** dDessy
//** 24-April-2019

$(function () {
    $('.tree li').hide();
    $('.tree li:first').show();
    $('.tree li').on('click', function (e) {
        var children = $(this).find('> ul > li');
        if (children.is(":visible")) children.hide('fast');
        else children.show('fast');
        e.stopPropagation();
    });
});

function ambil(data, apa) {
	var hasil = "";
	var res = document.getElementById("hasil");
    var x = JSON.stringify(data);
    var y = JSON.parse(x);
    var z = y.CompleteSuggestion;
    z.forEach(element => {
    	hasil += element.suggestion["@attributes"].data + '<br>';
    });
    res.insertAdjacentHTML("beforeend", "<li><a>" + apa + "</a><ul><li><a>" + hasil + "</a></li></ul></li>");
    tampil("tidak");
    pohon();
}

function pohon() {
	if (document.getElementById("pohon").style.display === "none") {
		document.getElementById("pohon").style.display = "block";
	}
}

function genCharArray(charA, charZ) {
    var a = [], i = charA.charCodeAt(0), j = charZ.charCodeAt(0);
    for (; i <= j; ++i) {
        a.push(String.fromCharCode(i));
    }
    return a;
}

function masal() {
	var keyword = document.getElementById("key").value;
	if (keyword.includes(",")) {
		tampil("tidak");
		document.getElementById("err").innerHTML = "Pake Keyword Satu Aja Ya...";
		return;
	} else {
		if (keyword.includes(" ")) {
			keyword = keyword.replace(" ", "_");
			genCharArray("a", "z").forEach(huruf => {
				mulai(keyword + "_" + huruf);
			});
		} else {
			genCharArray("a", "z").forEach(huruf => {
				mulai(keyword + "_" + huruf);
			});
		}
	}
}

function cek() {
	tampil("ya");
	document.getElementById("err").innerHTML = "";
	var az = document.getElementById("az").checked;
	var ind = document.getElementById("indo").checked;
	var ing = document.getElementById("ing").checked;
	if (az === true) {
		masal();
		retun;
	}
	if (ind === true && ing === true) {
		document.getElementById("err").innerHTML = "Tolong pilih bahasa salah satu. B.Indonesia atau B.Inggris";
		tampil("tidak");
		retun;
	}
	var keyword = document.getElementById("key").value;
	keyword = keyword.replace(/ ,| , |, /g, ",");
	if (keyword.includes(" ") && keyword.includes(",")) {
		keyword = keyword.replace(" ", "_");
		keyword = keyword.split(",");
	} else {
		if (keyword.includes(" ")) {
			keyword = keyword.replace(" ", "_");
			mulai(keyword);
			retun;
		} else if (keyword.includes(",")) {
			keyword = keyword.split(",");
		} else {
			mulai(keyword);
			retun;
		}
	}
	if (keyword.length > 0) {
		//keyword.forEach(key => {
			//mulai(key);
		//});
		for (var i=0;i<keyword.length;i++) {
			mulai(keyword[i]);
		}
	}
}

function mulai(keyword) {
	var langu = "id";
	var ind = document.getElementById("indo").checked;
	var ing = document.getElementById("ing").checked;
	if (ind === true && langu == "en") {
		langu = "id";
	}
	if (ing === true && langu == "id") {
		langu = "en";
	}
	var scriptTag = document.createElement('SCRIPT');
	scriptTag.src = "https://ddessy.000webhostapp.com/sGoogle_v1.php?keyword=" + keyword + "&lang=" + langu + "&callback=ambil";
	document.getElementsByTagName('HEAD')[0].appendChild(scriptTag);
}

function tampil(iya) {
	var apa = document.getElementById("muter").style.display;
	if (iya == "ya") {
		if (apa == "none") {
			document.getElementById("muter").style.display = "block";
		}
	} else {
		document.getElementById("muter").style.display = "none";
	}
}
