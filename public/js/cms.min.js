var global = "";

function apaAja(id) {
	return document.getElementById(id);
}
	
function bold() {
	var b = prompt("Masukan Teks");
	if (b !== "" && b) {
		apaAja("konten").value += "<b>" + b + "</b>";
	}
}

function italic() {
	var i = prompt("Masukan Teks");
	if (i !== "" && i) {
		apaAja("konten").value += "<i>" + i + "</i>";
	}
}

function underline() {
	var u = prompt("Masukan Teks");
	if (u !=="" && u) {
		apaAja("konten").value += "<u>" + u + "</u>";
	}
}

function link() {
	var l = prompt("Masukan Link");
	if (l !=="" && l) {
		apaAja("konten").value += '<a href="' + l + '">' + l + '</a>';
	}
}
	
function simpan() {
	var judul = apaAja("judul").value;
	var penulis = apaAja("penulis").value;
	var tanggal = apaAja("hari").value;
	var deskripsi = apaAja("deskripsi").value;
	var konten = apaAja("konten").value;
	var layout = tulisArtikel(judul, penulis, tanggal, deskripsi, konten);
	downloadArtikel(layout, cekArtikel(), 'application/json');
}

function expandTextarea(id) {
    apaAja(id).addEventListener('keyup', function() {
        this.style.overflow = 'hidden';
        //this.style.height = 0;
        if (this.scrollHeight > 200) {
        	this.style.height = this.scrollHeight + 'px';
        }
    }, false);
}

function downloadArtikel(strData, strFileName, strMimeType) {
    var D = document,
        A = arguments,
        a = D.createElement("a"),
        d = A[0],
        n = A[1],
        t = A[2] || "text/plain";

    //build download link:
    a.href = "data:" + strMimeType + "charset=utf-8," + escape(strData);

    if (window.MSBlobBuilder) { // IE10
        var bb = new MSBlobBuilder();
        bb.append(strData);
        return navigator.msSaveBlob(bb, strFileName);
    } /* end if(window.MSBlobBuilder) */

    if ('download' in a) { //FF20, CH19
        a.setAttribute("download", n);
        a.innerHTML = "downloading...";
        D.body.appendChild(a);
        setTimeout(function() {
            var e = D.createEvent("MouseEvents");
            e.initMouseEvent("click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
            a.dispatchEvent(e);
            D.body.removeChild(a);
        }, 66);
        return true;
    }; /* end if('download' in a) */

    //do iframe dataURL download: (older W3)
    var f = D.createElement("iframe");
    D.body.appendChild(f);
    f.src = "data:" + (A[2] ? A[2] : "application/octet-stream") + (window.btoa ? ";base64" : "") + "," + (window.btoa ? window.btoa : escape)(strData);
    setTimeout(function() {
        D.body.removeChild(f);
    }, 333);
    return true;
}

function tulisArtikel(jdl, pnl, tgl, des, kn) {
	var layoutArtikel = [{
		judul : jdl,
		penulis : pnl,
		tanggal : tgl,
		deskripsi : des,
		konten : kn
	}];
	return JSON.stringify(layoutArtikel);
}
	
function artikelExists(url) {
    var http = new XMLHttpRequest();
    http.open('HEAD', url, false);
    http.send();
    return http.status==200;
}

function hari() {
	var event = new Date();
	var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
	return event.toLocaleDateString('id-ID', options);
}

function showHide(id) {
	var hide = apaAja("featuresartikel");
	var show = apaAja("utama");
	if (artikelExists("public/artikel/" + id + ".json")) {
		var jArtikel = readFile("public/artikel/" + id + ".json");
		var parseArtikel = JSON.parse(jArtikel);
		parseArtikel.forEach( bagian => {
			show.innerHTML = '<h1>' + bagian.judul + '</h1><label>Penulis : ' + bagian.penulis + '</label><label style="margin-left:2em;">Tanggal : ' + bagian.tanggal + '</label><br>' + bagian.konten;
			show.style.display = " block";
		});
	}
	hide.style.display = "none";
	apaAja("kembali").style.display = "block";
}

function hideShow() {
	var fet = apaAja("featuresartikel");
	var atk = apaAja("utama");
	if (fet.style.display === "none") {
		atk.innerHTML = "";
		fet.style.display = "block";
		apaAja("kembali").style.display = "none";
	}
}

function featuresArtikel() {
	//var label = '<label>Artikel</label>';
	var panelKepala = '<div class="panel panel-default"><div class="panel-body"><h2 class="blog-post-title"><a ';
	var panelMeta = '</a></h2><p class="blog-post-meta"><b>';
	var panelBadan = '</b></p><p>';
	var panelFoot = '</p><button class="btn btn-primary pull-right"';
	var panelClick = '>Lanjutkan Membaca';
	var panelAkhir = '</button></div></div>';
	var dirArtikel = "public/artikel/";
	var i;
	for (i = 0; i < 20; i++) {
		if(artikelExists(dirArtikel + i + ".json")) {
			var jsonKonten = readFile(dirArtikel + i + ".json");
			var parseKonten = JSON.parse(jsonKonten);
			parseKonten.forEach(element => {
				var features = panelKepala + "id='" + i + "' onclick='showHide(this.id)'>" + element.judul + panelMeta + "Penulis : " + element.penulis + " Tanggal : " + element.tanggal + panelBadan + element.deskripsi + "..." + panelFoot + " id='" + i + "' onclick='showHide(this.id)'" + panelClick + panelAkhir;
				var awal = apaAja("featuresartikel").innerHTML;
				apaAja("featuresartikel").innerHTML = features + awal;
			});
		} else {
			break;
		}
	}
}

function readFile(url) {
	var res;
	var request;
	var isIE8 = window.XDomainRequest ? true : false;
	if (isIE8) {
		request = new window.XDomainRequest();
	} else {
		request = new XMLHttpRequest();
	}
	if (request) {
		if(isIE8) {
			request.onload = showArtikel(request.responseText);
			request.open("GET", url, false);
			request.send();
		} else {
			request.open('GET', url, false);
			request.onreadystatechange = function() {
				if (request.readyState == 4) {
					if (request.status == 200) {
						res = request.responseText;
					} else {
						res = "artikel tidak ditemukan";
					}
				}
			}
			request.send();
		}
	} else {
		res = "gagal koneksi request";
	}
	return res;
}

function cekArtikel() {
	var dir = 'public/artikel/';
	var x;
	for (x = 0; x < 20; x++) {
		if(!artikelExists(dir + x + ".json")) {
			return x + ".json";
		}
	}
}

function jumlahKata() {
	var jdl = apaAja("judul").value;
	var des = apaAja("deskripsi").value;
	var teks = apaAja("konten").value;
	var kata = teks.split(' ').length;
	if (jdl.length > 0) {
		if (jdl.length > 60) {
			apaAja("jumlahjudul").innerHTML = "<span class='text-danger glyphicon glyphicon-exclamation-sign'>" + " panjang karakter : " +  jdl.length + "</span>";
		} else {
			apaAja("jumlahjudul").innerHTML = " panjang karakter : " +  jdl.length;
		}
	} else {
		apaAja("jumlahjudul").innerHTML = "";
	}
	if (des.length > 0) {
		if (des.length > 160) {
			apaAja("jumlahdeskripsi").innerHTML = "<span class='text-danger glyphicon glyphicon-exclamation-sign'>" + " panjang karakter : " +  des.length + "</span>";
		} else {
			apaAja("jumlahdeskripsi").innerHTML = " panjang karakter : " +  des.length;
		}
	} else {
		apaAja("jumlahdeskripsi").innerHTML = "";
	}
	if (teks.length < 1) {
		kata = 0;
		apaAja("jumlah").innerHTML = "";
	} else {
		apaAja("jumlah").innerHTML = "jumlah kata : " + kata;
	}
}

function tampil() {
	var apa = apaAja("preview").className;
	if(apa === "collapse") {
		apaAja("preview").className = "collapse-in";
	} else {
		apaAja("preview").className = "collapse";
	}
}

function preview() {
	apaAja("preview").innerHTML = konten();
}

function konten() {
	var kepala = '<h1>' + apaAja("judul").value + '</h1><label>Penulis : ' + apaAja("penulis").value + '</label>' + '<label style="margin-left:2em;">Tanggal : ' + apaAja("hari").value + '</label>';
	var konten = apaAja("konten").value;
	//var kn = konten.split(/(?:\r\n|\r|\n)/g);
	var badan = '<p style=" text-align:' + global + ';">' + konten + '</p>';
	return kepala + badan;
}

function btnAktif(id) {
	var y = ["left", "right", "center", "justify"];
	var i;
	for (i = 0; i < y.length; i++)
	{
		if (y[i].includes(id))
		{
			if (apaAja(y[i]).className === "btn btn-default")
			{
				apaAja(y[i]).className = "btn";
				global = y[i];
			}
			else
			{
				apaAja(y[i]).className = "btn btn-default";
			}
		}
		else
		{
			if (apaAja(y[i]).className === "btn")
			{
				apaAja(y[i]).className = "btn btn-default";
			}
		}
	}
}
